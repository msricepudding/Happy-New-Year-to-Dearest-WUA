<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 跨年记忆 - 3D Heart</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: #e5b39b; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #status-text { margin-bottom: 20px; font-size: 16px; letter-spacing: 2px; text-align: center; padding: 0 20px; }
        #start-btn { display: none; padding: 12px 30px; background: transparent; color: #e5b39b; border: 1px solid #e5b39b; cursor: pointer; font-size: 16px; }
        #info { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; z-index: 10; }
        #webcam-container { position: absolute; bottom: 10px; left: 10px; width: 120px; height: 90px; border: 1px solid #b76e79; opacity: 0.4; transform: scaleX(-1); pointer-events: none; }
        video { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>
    <div id="loading">
        <div id="status-text">正在准备 2026 跨年惊喜...</div>
        <button id="start-btn">开启记忆</button>
    </div>
    <div id="info">
        <h1 style="letter-spacing: 5px; font-size: 24px;">2026 ECHOES OF LOVE</h1>
        <p id="hint-text">正在初始化交互模式...</p>
    </div>
    <div id="webcam-container"><video id="webcam-video" autoplay playsinline></video></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://fastly.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://fastly.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://fastly.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script type="module">
        import * as THREE from 'three';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';

        let scene, camera, renderer, composer, heartGroup, photos = [];
        let isExploded = false, isTouchMode = false;
        let cameraTargetRotation = new THREE.Vector2(0, 0);
        const PHOTO_COUNT = 21; 

        const statusText = document.getElementById('status-text');
        const startBtn = document.getElementById('start-btn');
        const hintText = document.getElementById('hint-text');
        const videoElement = document.getElementById('webcam-video');

        async function init() {
            setupScene();
            try {
                statusText.innerText = "正在加载回忆照片 (21张)...";
                await createPhotoHeart();
                
                statusText.innerText = "尝试开启 AI 手势识别...";
                await setupMediaPipe();
                hintText.innerText = "张开手掌爆炸 / 握拳凝聚";
            } catch (err
